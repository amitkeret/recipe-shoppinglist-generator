doctype html
html
  head: include ./head.pug
  body

    #app

      include ./recipe-placeholder.pug

      .container.py-3

        .row.justify-content-center
          h3.mb-4 Shopping list generator

        #step1.card.shadow.mb-4
          .card-header: .row
            .col-9.col-sm
              section-title(text="1" :title="editindex > -1 ? 'Edit recipe' : 'Add recipes'" @click="step1toggle")
              icon.ml-1.fa-lg(:icon="step1visible ? 'caret-up' : 'caret-down'")
            .col.text-right
              .dropdown#recipes-backup
                button-icon.dropdown-toggle(icon="database" text="Recipes DB" text-breakpoint="sm" data-toggle="dropdown")
                .dropdown-menu
                  //- https://codepen.io/pieceofcode/pen/zldng
                  label.dropdown-item.file-upload__label(for="recipesFile" text="Load")
                    icon.mr-2(icon="file-import")
                    | Load
                  input#recipesFile.file-upload__input(type="file" name="files" @change="importRecipes")
                  .dropdown-item(@click="exportRecipes")
                    icon.ml-n2.mr-2(icon="file-download")
                    | Save
                  div(v-if="recipes.length > 0")
                    .dropdown-divider
                    .dropdown-item(@click="clearRecipes")
                      icon.ml-n2.mr-2(icon="broom" color="danger")
                      | Clear

          .card-body(v-show="step1visible == true"): .row
            include ./recipe-form.pug

        #step2.card.shadow.mb-4

          .card-header.pb-2: .row
            .col-9.col-lg-3.mb-2.mb-lg-0
              section-title(text="2" title="Select recipes")
              icon.ml-1.clickable(
                v-show="Recipes.selected().length > 0"
                icon="clone" family="far" color="outline-dark"
                title="Select none" @click="selectNone"
              )

            .col.card-header-actions.d-flex.flex-wrap.flex-md-nowrap.align-items-center.justify-content-end

              //- Random recipe
              button-icon#randomRecipe.order-1.fa-lg.px-1(
                ref="randomRecipe" @click="randomRecipe" v-if="recipes.length > 0"
                icon="dice" color="primary" title="Random recipe"
              )

              //- Recipe filter
              .input-group.order-4.order-md-2
                input.form-control(v-model="filters.query" ref="query" placeholder="Search recipe details")
                .input-group-append: button-icon(icon="times" color="danger" title="Clear search" @click="clearQuery")

              //- Ingredients filter
              .input-group.order-5.order-md-3
                vue-multiselect(
                  v-model="filters.ings"
                  placeholder="Search ingredients"
                  label="name"
                  track-by="name"
                  :options="Ingredients.listFlat()"
                  :multiple="true"
                )
                .input-group-append
                  button-icon(icon="times" color="danger" title="Clear" @click="filters.ings = []")
                  input(type="checkbox" v-model="filters.ingModeAnd"
                    data-toggle="switchbutton" id="switchbutton-filters-ingModeAnd"
                    data-onlabel="AND"
                    data-offlabel="OR"
                    data-onstyle="danger"
                    data-offstyle="warning"
                    data-height="auto"
                  )

              //- Rating filiter
              button-icon#filter-rating.order-2.order-md-4(
                icon="star"
                :text="filters.rating ? filters.rating : false"
                :color="filters.rating ? 'warning' : 'outline-dark'"
                title="Filter starred recipes"
                @click="filters.rating = filters.rating == 5 ? false : filters.rating + 1"
              )

              //- Veg filter
              button-icon.order-3.order-md-5(
                icon="leaf"
                :color="filters.veg ? 'success' : 'outline-dark'"
                title="Toggle vegetarian"
                @click="filters.veg = !filters.veg"
              )

          //- Recipes list
          .card-body.py-2
            recipe-item(v-for="(recipe, index) in recipes"
              :recipe="recipe"
              :filters="filters"
              @updaterecipe="Recipes.update(index)"
              @deleterecipe="Recipes.delete(index)"
              @emodalrecipe="Recipes.eModal(index)"
            )

        #step3.card.shadow
          .card-header: .row.justify-content-between
            .col-lg-4.mb-2.mb-lg-0: section-title(text="3" title="Create shopping list")
            .col.text-right(v-if="Recipes.selected().length > 0")
              span.mr-2 {{ Recipes.selected().length }} recipes, {{ Recipes.selected('servings') }} servings
              button-icon.mr-1(
                title="Generate shopping list"
                icon="shopping-basket" color="primary"
                text="Generate shopping list" text-breakpoint="md"
                v-clipboard:copy="clipboardShoppingList"
                v-clipboard:success="onCopy"
                v-clipboard:error="onError"
              )
              button-icon(
                title="Preview selected recipes"
                icon="clipboard-list" color="primary"
                text="Preview selected recipes" text-breakpoint="md"
                v-clipboard:copy="clipboardMenues"
                v-clipboard:success="onCopy"
                v-clipboard:error="onError"
              )

    include ./foot.pug
